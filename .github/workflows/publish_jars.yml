name: Upload Release Assets

on:
  push:
    branches: [ 1588-publish-to-maven-central ]
#  release:
#    types: [ prereleased, released ]

jobs:
  build-jars:
    runs-on: ubuntu-latest

    steps:
    
      - name: Load secrets from 1Password
        id: onepw_secrets
        uses: 1password/load-secrets-action@v1.3.1
        with:
            export-env: true # Export loaded secrets as environment variables
        env:
            OP_SERVICE_ACCOUNT_TOKEN: ${{ secrets.OP_SERVICE_ACCOUNT_TOKEN }} # This is required to connect to the vault in our 1Password account.
            MAVEN_GPG_PRIVATE_KEY: "op://rbiv7rvkkrsdlpcrz3bmv7nmcu/yztcx47yzp4vizjyaq7ulvkgoi/Private key"
            MAVEN_GPG_PASSPHRASE: "op://rbiv7rvkkrsdlpcrz3bmv7nmcu/yztcx47yzp4vizjyaq7ulvkgoi/password"
            SONATYPE_USERNAME: ${{secrets.SONATYPE_USERNAME}}
            SONATYPE_PASSWORD: ${{secrets.SONATYPE_PASSWORD}}


#      - name: Checkout code
#        uses: actions/checkout@v2
#
#      - name: Set up JDK 17
#        uses: actions/setup-java@v3
#        with:
#          java-version: '17'
#          distribution: 'zulu'
#

      - name: Modify the private key format
        run: echo "${MAVEN_GPG_PRIVATE_KEY}" | sed 's/ /\'$'\n/g' > modified_key.asc
        # Now the key is saved in a file called modified_key.asc in the runner's workspace

      - name: Import GPG key
        run: |
          echo "modified key"
          cat modified_key.asc
          echo "modified key end"
          gpg --batch --import modified_key.asc
          gpg --list-keys
#
#      - name: Build and Publish
#        run: ./gradlew publish

      - name: Print trucs
        run: |
          echo "Hello World!"
          echo "truc1"
          echo $MAVEN_GPG_PASSPHRASE
          echo "truc2"
          echo $MAVEN_GPG_PRIVATE_KEY


