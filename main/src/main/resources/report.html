<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>GTFS Validation Report</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8; width=device-width, initial-scale=1" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            font-family: Helvetica, Arial, sans-serif;
            font-size: 14px;
            min-width: 800px;
        }

        .error:before {
            content: "\1F534  ";
        }

        .warning:before {
            content: "\1F7E0  ";
        }

        .info:before {
            content: "\26AA  ";
        }

        * {
            box-sizing: border-box;
        }

        body {
            padding: 1em 2em;
        }

        table {
            width: 100%;
        }
        table th {
            text-align: left;
            border-bottom: 2px solid #000;
            padding: 0.5em;
        }
        table td {
            border-bottom: 1px solid #ddd;
            padding: 0.5em;
        }

        table.accordion > tbody > tr.notice td, table.accordion > tbody > tr.view th {
            cursor: auto;
        }
        table.accordion > tbody > tr.notice td:first-child,
        table.accordion > tbody > tr.notice th:first-child {
            position: relative;
            padding-left: 20px;
        }
        table.accordion > tbody > tr.notice td:first-child:before,
        table.accordion > tbody > tr.notice th:first-child:before {
            position: absolute;
            top: 50%;
            left: 5px;
            width: 9px;
            height: 16px;
            margin-top: -8px;
            color: #000;
            content: "+";
        }
        table.accordion > tbody > tr.notice.open td:first-child:before,
        table.accordion > tbody > tr.notice.open th:first-child:before {
            content: "\2013";
        }
        table.accordion > tbody > tr.notice:hover {
            background: #ddd;
        }
        table.accordion > tbody > tr.notice.open {
            background: #ddd;
            color: black;
        }
        table.accordion > tbody > tr.description {
            display: none;
        }
        table.accordion > tbody > tr.description.open {
            display: table-row;
        }

        .desc-content {
            padding: 0.5em;
            border-bottom: 5px solid #000;
            border-top: 5px solid #000
        }
        .desc-content h3 {
            margin-top: 0;
        }
    </style>
</head>

<body>
<h1>VALIDATION REPORT</h1>
<h2><span th:text="${summary.noticeCount}">X</span> notices reported
    (<span th:text="${summary.errorCount}">0</span> errors,
    <span th:text="${summary.warningCount}">0</span> warnings,
    <span th:text="${summary.infoCount}">0</span> infos)</h2>
<p>Please visit <a href="https://github.com/MobilityData/gtfs-validator/blob/master/docs/NOTICES.md">NOTICES.md</a> and <a href="https://github.com/MobilityData/gtfs-validator/blob/master/RULES.md">RULES.md</a>.</p>
<table class="accordion">
    <thead>
    <tr>
    <th>Code</th><th>Name</th><th>Severity</th><th>Total</th>
    </tr>
    </thead>
    <tbody>
    <span th:each="noticesBySeverityLevel: ${summary.noticesMap}">
        <span th:each="noticeByCode: ${noticesBySeverityLevel.value}">
            <tr class="notice">
                <td th:text="${noticeByCode.key}" />
                <td th:text="${noticeByCode.value.get(0).getName()}" />
                <td th:class="${noticesBySeverityLevel.key.toString().toLowerCase()}" th:text="${noticesBySeverityLevel.key}" />
                <td th:text="${noticeByCode.value.size()}" />
            </tr>
            <tr class="description">
                <td colspan="4">
                    <div class="desc-content">
                        <h3 th:text="${noticeByCode.value.get(0).getName()}" />
                        <p> Please find this notice description <a th:href="@{'https://github.com/MobilityData/gtfs-validator/blob/master/RULES.md#' + ${noticeByCode.value.get(0).getName()}}">here</a>.</p>
                        <table>
                            <thead>
                                <tr>
                                    <th:block th:each="field: ${noticeByCode.value.get(0).getFields()}" >
                                        <th th:text="${field.getName()}" />
                                    </th:block>
                                </tr>
                            </thead>
                            <span th:each="notice: ${noticeByCode.value}">
                                <tbody>
                                <tr>
                                <th:block th:each="field: ${notice.getFields()}">
                                        <td th:text="${notice.getContext().getAsJsonObject().get(field.getName())}" />
                                </th:block>
                                </tr>
                                </tbody>
                            </span>
                        </table>
                    </div>
                </td>
            </tr>
        </span>
    </span>
    </tbody>
</table>
<p>This validation report was generated using the <a href="https://github.com/MobilityData/gtfs-validator">GTFS Schedule validator</a>.</p>
</body>
<script>
    $(function(){
        $(".accordion tr.notice").on("click", function(){
            $(this).toggleClass("open").next(".description").toggleClass("open");
        });
    });
</script>
</html>